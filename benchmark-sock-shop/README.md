# Benchmarking sockshop

This scripts aims to benchmark the microservices-demo (sock shop). Two users will be used (user and user1). In the installation script, they will both add some article to their carts. Since Sock Shop rejects an order of more than $100, the amount for the first user will be less than 100, and more than 100 for the second. 

The benchmark will be done on the carts previously described. The route POST /orders will be tried (real work is done here). 

## Configuration

Three different manifests are provided: 

* swarm-manifest: the original docker-compose.yml file, modified to remove the unsupported tmpfs (replaced by an empty volume)
* kompose-manifest: a manifest generated with Kompose, using the original docker-compose file. 
* k8s-manifest: the original k8s manifest

These repositories have to be copied on the home repositories of the targetted master. They must include `restart.sh`, which will be called between each test. 
*The cluster have to be installed, and compatible with the provided repository. You can use `docker swarm init` or kubeadm to create them*. 


## The install.sh script
 
```bash
./install.sh <your master machine> --fast
``` 

The fast flag is optionnal. If present, the cluster manifest will not be reset. This script will generate three files: url.ip, possible.cookie and impossible.cookie. It will also remove all existing carts for the two users. 
Then, the sock colourful will be placed to the cart, 4 times for user, 10 for user1. 

After the execution of the script, post /orders for user will be accepted, and rejected for user1. The file url.ip can be used for wrk_tput.sh. You will also have to choose which from 
impossible.cookie (user1) and possible.cookie (user) you want to use. 


## The wrk_tput.sh script

```bash 
./wrk_tput.sh <MANAGER> <CLUSTER_MANAGER> <COOKIE_FILE> [throughput file] 
``` 

* MANAGER is the machine from which all the requests will be launched. Do not use a machine already in use by the cluster.  
* CLUSTER_MANAGER is the master of the cluster to test. 
* URL_FILE is generated by the install.sh script
* COOKIE_FILE is generated by install.sh (possible.cookie or impossible.cookie). 
* throughput file: can be used to specify the throughput to use. If no file specified, ${1,3,5,7,9}*10^{1..5}$ will be used. 

The script will first call the install.sh. Then launch the load test (provided by microservices-demo) to set up the cache. And finally launch wrk with 100 connections, 2 threads, and over 2 minutes.

 


  
